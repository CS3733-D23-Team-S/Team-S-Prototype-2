<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExampleController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Team-S-Prototype-2</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.teamname.controllers</a> &gt; <span class="el_source">ExampleController.java</span></div><h1>ExampleController.java</h1><pre class="source lang-java linenums">package edu.wpi.teamname.controllers;

import java.io.IOException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;

<span class="nc" id="L12">public class ExampleController {</span>
  @FXML Button ClickButton; // fx:ID of the button in the ExampleFXML
<span class="nc" id="L14">  private Connection connection = null; // connection to database</span>

  /** Method run when controller is initializes */
  public void initialize() {
    // if connection is successful
<span class="nc bnc" id="L19" title="All 2 branches missed.">    if (this.connectToDB()) {</span>
<span class="nc" id="L20">      this.createTable();</span>
    }
<span class="nc" id="L22">  }</span>

  /**
   * When the button is clicked, the method will log the data in the terminal and database
   *
   * @param actionEvent event that triggered method
   * @throws IOException
   */
  public void buttonClicked(ActionEvent actionEvent) throws IOException {
<span class="nc" id="L31">    System.out.println(&quot;Button was clicked&quot;);</span>
<span class="nc bnc" id="L32" title="All 2 branches missed.">    System.out.println(this.logData() ? &quot;Data logged&quot; : &quot;Data NOT logged&quot;);</span>
<span class="nc" id="L33">  }</span>

  /**
   * Generates connection to server on localhost at default port (1521) be aware of the username and
   * password when testing
   *
   * @return True when connection is successful, False when failed
   */
  private boolean connectToDB() {

    try {
<span class="nc" id="L44">      Class.forName(</span>
          &quot;org.apache.derby.jdbc.ClientDriver&quot;); // Check that proper driver is packaged for Apache
      // Derby
<span class="nc" id="L47">    } catch (Exception e) {</span>
<span class="nc" id="L48">      e.printStackTrace();</span>
<span class="nc" id="L49">      System.out.println(&quot;NO DRIVER&quot;);</span>
<span class="nc" id="L50">      return false;</span>
<span class="nc" id="L51">    }</span>
    try {
      // create Connection at specified URL
<span class="nc" id="L54">      this.connection =</span>
<span class="nc" id="L55">          DriverManager.getConnection(</span>
              &quot;jdbc:derby://localhost:1527/testDB;create=true&quot;,
              &quot;app&quot;,
              &quot;derbypass&quot;); // This will change for each team as their DB is developed
<span class="nc bnc" id="L59" title="All 2 branches missed.">      if (this.connection != null) {</span>
<span class="nc" id="L60">        System.out.println(&quot;Connected to the database!&quot;);</span>
      } else {
<span class="nc" id="L62">        System.out.println(&quot;Failed to make connection!&quot;);</span>
      }
<span class="nc" id="L64">    } catch (SQLException e) {</span>
<span class="nc" id="L65">      System.err.format(&quot;SQL State: %s\n%s&quot;, e.getSQLState(), e.getMessage());</span>
<span class="nc" id="L66">      return false;</span>
<span class="nc" id="L67">    } catch (Exception e) {</span>
<span class="nc" id="L68">      e.printStackTrace();</span>
<span class="nc" id="L69">      return false;</span>
<span class="nc" id="L70">    }</span>

    // connection successful, return true
<span class="nc" id="L73">    return true;</span>
  }

  /**
   * generates a table to store button click information
   *
   * @return true when table is successfully created or already exists, false otherwise
   */
  private boolean createTable() {

<span class="nc" id="L83">    boolean table_exists = false;</span>

<span class="nc bnc" id="L85" title="All 2 branches missed.">    if (this.connection != null) {</span>
<span class="nc" id="L86">      String createQuery =</span>
          &quot;CREATE TABLE APP.buttonClicks(&quot;
              + &quot;id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), &quot;
              + &quot;btn_name VARCHAR(50), &quot;
              + &quot;time_stamp TIMESTAMP NOT NULL, &quot;
              + &quot;PRIMARY KEY(id) )&quot;;
      try {
<span class="nc" id="L93">        Statement statement = this.connection.createStatement();</span>
<span class="nc" id="L94">        statement.execute(createQuery);</span>

<span class="nc" id="L96">        table_exists = true;</span>
<span class="nc" id="L97">      } catch (SQLException e) {</span>
        // Error code 955 is &quot;name is already used by an existing object&quot;, so this table name
        // already exists
<span class="nc bnc" id="L100" title="All 4 branches missed.">        if (e.getErrorCode() == 955 || e.getMessage().contains(&quot;already exists&quot;))</span>
<span class="nc" id="L101">          table_exists = true;</span>
<span class="nc" id="L102">        else e.printStackTrace();</span>
<span class="nc" id="L103">      }</span>
    }
<span class="nc" id="L105">    return table_exists;</span>
  }

  /**
   * Stores button click data to database
   *
   * @return true if data is stored successfully, false otherwise
   */
  private boolean logData() {
<span class="nc bnc" id="L114" title="All 2 branches missed.">    if (connection != null) {</span>
<span class="nc" id="L115">      String writeQuery =</span>
          &quot;INSERT INTO APP.buttonClicks(btn_name, time_stamp) VALUES ( 'ClickButton', CURRENT_TIMESTAMP ) &quot;;
      try {
<span class="nc" id="L118">        Statement statement = this.connection.createStatement();</span>
<span class="nc" id="L119">        statement.execute(writeQuery);</span>
<span class="nc" id="L120">        return true;</span>
<span class="nc" id="L121">      } catch (SQLException e) {</span>
<span class="nc" id="L122">        e.printStackTrace();</span>
      }
    }
<span class="nc" id="L125">    return false;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>